<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Jens Christian Wahl" />


<title>stochvolTMB: Likelihood estimation of stochastic volatility</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">stochvolTMB: Likelihood estimation of stochastic volatility</h1>
<h4 class="author">Jens Christian Wahl</h4>



<div id="the-stochastic-volatility-model" class="section level1">
<h1>The stochastic volatility model</h1>
<p>The stochastic volatility model, introduced by <span class="citation">Taylor (1982)</span>, is defined by <span class="math display">\[\begin{equation}
    \begin{aligned}
        y_t &amp;= \sigma_y e^{h_t/2} \epsilon_t, \quad t = 1, \dots, T, \\
        h_{t+1} &amp;= \phi h_{t} + \sigma_h \eta_t, \quad t = 1, \dots, T-1, \\
        \eta_t &amp;\stackrel{\text{iid}}{\sim} \mathcal{N}(0,1), \\
        \epsilon_t &amp;\stackrel{\text{iid}} {\sim}  F
    \end{aligned}
\end{equation}\]</span> where <span class="math inline">\(y_t\)</span> is the observed log returns, <span class="math inline">\(h_t\)</span> is the logarithm of the variance on day <span class="math inline">\(t\)</span>. The distribution of the innovations <span class="math inline">\(\epsilon_t\)</span> is specified below. To ensure stationarity for <span class="math inline">\(h_t\)</span>, we assume <span class="math inline">\(|\phi| &lt; 1\)</span>. It can be shown that the unconditional distribution of <span class="math inline">\(h_t\)</span> is <span class="math inline">\(\mathcal{N}(0,\sigma_h^2/(1 - \phi^2))\)</span>, and we assume <span class="math inline">\(h_1 \sim \mathcal{N}(0,\sigma_h^2/(1-\phi^2))\)</span>. An interpretation of the latent process <span class="math inline">\(\{h_t\}\)</span> is that is represents the random and uneven flow of new information into the marked. For different time points, the variance will be dependent of this unobserved ``flow’’ of information, i.e. conditioning on <span class="math inline">\(h_t\)</span>, <span class="math inline">\(\mathrm{Var}(y_t | h_t) = \sigma_x^2 e^{h_t}\)</span>.</p>
<p>The original SV model from <span class="citation">Taylor (1982)</span> assumed normally distributed innovations, but this is usually to strong of an assumption. Financial returns are usually heavy-tailed, might be asymmetric and the volatility can be correlated with the returns. The latter is called the <em>leverage effect</em>, where there is a negative correlation between a change in price and the volatility, meaning that a drop in price tend to lead to an increase in volatility To take these features of financial time series into account <code>stochvolTMB</code> has implemented the following four distribution for the innovations:</p>
<ul>
<li>Gaussian: <span class="math inline">\(\epsilon_t \sim \mathcal{N}(0,1)\)</span></li>
<li>t: <span class="math inline">\(\epsilon_t \sim t_\nu(0,1)\)</span>, where <span class="math inline">\(\nu\)</span> is the degrees of freedom.</li>
<li>Skew-Gaussian: <span class="math inline">\(\epsilon_t \sim \mathcal{SN}(0,1, \alpha)\)</span>, with zero mean, unit variance and skewness parameter <span class="math inline">\(\alpha\)</span>.</li>
<li>Leverage: <span class="math inline">\(\epsilon_t \sim \mathcal{N}(0,1)\)</span> and <span class="math inline">\(\mathrm{Cor}(\epsilon_t, \eta_t) = \rho\)</span></li>
</ul>
<p><code>stochvolTMB</code> is inspired by the package <a href="https://github.com/gregorkastner/stochvol">stochvol</a> (<span class="citation">Kastner (2016)</span>), but <code>stochvolTMB</code> obtain parameter estimates through maximum likelihood estimation and not Markov Chain Monte Carlo.</p>
</div>
<div id="usage" class="section level1">
<h1>Usage</h1>
<p>The main functions of <code>stochvolTMB</code> are:</p>
<table>
<colgroup>
<col width="35%"></col>
<col width="64%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="left">Function Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>estimate_parameters</code></td>
<td align="left">Estimate parameters of a stochastic volatility model.</td>
</tr>
<tr class="even">
<td align="left"><code>sim_sv</code></td>
<td align="left">Simulate data from a stochastic volatility model.</td>
</tr>
<tr class="odd">
<td align="left"><code>plot.stochvolTMB</code></td>
<td align="left">Plot estimated volatility and predicted (with confidence intervals).</td>
</tr>
<tr class="even">
<td align="left"><code>summary.stochvolTMB</code></td>
<td align="left">Extract parameter estimates and volatility with uncertainty.</td>
</tr>
<tr class="odd">
<td align="left"><code>predict.stochvolTMB</code></td>
<td align="left">Predict future volatility and returns.</td>
</tr>
</tbody>
</table>
<p><code>estimate_parameters</code> returns an object of class <code>stochvolTMB</code>. The <code>summary</code> function returns a <code>data.table</code> with estimated parameters, estimated log-volatility and transformed parameters along with standard errors, p-values and z-values. The argument <code>report = &quot;fixed&quot;</code> returns the parameters on the scale they were estimated. This means that the standard deviations <span class="math inline">\(\sigma_y, \sigma_h\)</span> are given on the log scale; the degrees of freedom is one the scale <span class="math inline">\(\log (\nu - 2)\)</span> to ensure that <span class="math inline">\(\nu &gt; 2\)</span> (i.e. the variance exists); and lastly that the persistence parameter <span class="math inline">\(\phi\)</span> and the correlation parameter <span class="math inline">\(\rho\)</span> are estimated on a logit scale to ensure that they are between -1 and 1. If <code>report = c(&quot;fixed&quot;, &quot;transformed&quot;)</code>, parameter estimates transformed back to their original scale is also returned. If you want to extract the estimated log-volatility you can use <code>report = &quot;random&quot;</code>.</p>
</div>
<div id="example" class="section level1">
<h1>Example</h1>
<p>Estimating parameters in a SV model is easy with <code>stochvolTMB</code>. As an example we investigate the daily log-returns of the S&amp;P500 from 2005 to 2018. A quick look at the data:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">data</span>(spy)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">plot</span>(spy<span class="op">$</span>date, spy<span class="op">$</span>log_return, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;Log-returns of S&amp;P500&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">plot</span>(spy<span class="op">$</span>date, spy<span class="op">$</span>price, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;Price of S&amp;P500&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>We fit all four distributions:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>gaussian =<span class="st"> </span><span class="kw">estimate_parameters</span>(spy<span class="op">$</span>log_return, <span class="dt">model =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="dt">silent =</span> <span class="ot">TRUE</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>t_dist =<span class="st"> </span><span class="kw">estimate_parameters</span>(spy<span class="op">$</span>log_return, <span class="dt">model =</span> <span class="st">&quot;t&quot;</span>, <span class="dt">silent =</span> <span class="ot">TRUE</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>skew_gaussian =<span class="st"> </span><span class="kw">estimate_parameters</span>(spy<span class="op">$</span>log_return, <span class="dt">model =</span> <span class="st">&quot;skew_gaussian&quot;</span>, <span class="dt">silent =</span> <span class="ot">TRUE</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a>leverage =<span class="st"> </span><span class="kw">estimate_parameters</span>(spy<span class="op">$</span>log_return, <span class="dt">model =</span> <span class="st">&quot;leverage&quot;</span>, <span class="dt">silent =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>We can investigate the estimate for the degrees of freedom (<code>df</code>) to see if the returns are heavy-tailed</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">summary</span>(t_dist, <span class="dt">report =</span> <span class="st">&quot;transformed&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">#&gt;    parameter     estimate    std_error    z_value      p_value        type</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt; 1:   sigma_y  0.008392879 0.0008689248   9.658924 4.505714e-22 transformed</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#&gt; 2:   sigma_h  0.185766767 0.0182175649  10.197124 2.042308e-24 transformed</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt; 3:       phi  0.984924644 0.0039281816 250.732972 0.000000e+00 transformed</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt; 4:        df 10.086366735 2.1022434966   4.797906 1.603330e-06 transformed</span></span></code></pre></div>
<p>Clearly the returns are more heavy tailed than Gaussian, even when controlling for the stochastic volatility. We can also check for asymmetric returns</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">summary</span>(skew_gaussian, <span class="dt">report =</span> <span class="st">&quot;fixed&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">#&gt;      parameter  estimate  std_error    z_value      p_value  type</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#&gt; 1: log_sigma_y -4.797828 0.09127165 -52.566466 0.000000e+00 fixed</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">#&gt; 2: log_sigma_h -1.556355 0.08899553 -17.488015 1.768107e-68 fixed</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#&gt; 3:   logit_phi  4.623512 0.23363755  19.789252 3.684695e-87 fixed</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt; 4:       alpha -1.088828 0.14275937  -7.627013 2.402559e-14 fixed</span></span></code></pre></div>
<p>and leverage (<code>rho</code>)</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">summary</span>(leverage, <span class="dt">report =</span> <span class="st">&quot;transformed&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co">#&gt;    parameter     estimate    std_error   z_value       p_value        type</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">#&gt; 1:   sigma_y  0.008338412 0.0004163314  20.02830  3.121144e-89 transformed</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt; 2:   sigma_h  0.273443559 0.0182641070  14.97164  1.125191e-50 transformed</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt; 3:       phi  0.967721215 0.0043681868 221.53842  0.000000e+00 transformed</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt; 4:       rho -0.748695259 0.0322487815 -23.21623 3.121690e-119 transformed</span></span></code></pre></div>
<p>There is clear evidence for both asymmetric returns and a negative correlation (of -0.74!) between log-returns and the volatility. To find the model that fits the data best, we can compare the <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion">AIC</a> of our models and pick the smallest.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">AIC</span>(gaussian, </span>
<span id="cb7-3"><a href="#cb7-3"></a>    t_dist, </span>
<span id="cb7-4"><a href="#cb7-4"></a>    skew_gaussian, </span>
<span id="cb7-5"><a href="#cb7-5"></a>    leverage)</span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt;               df       AIC</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt; gaussian       3 -23430.57</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt; t_dist         4 -23451.69</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt; skew_gaussian  4 -23440.87</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt; leverage       4 -23608.85</span></span></code></pre></div>
<p>Clearly the leverage model outperforms the others and is our preferred model for this dataset. Lastly, we can also plot the estimated log-volatility and volatility:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">plot</span>(leverage, <span class="dt">include_ci =</span> <span class="ot">TRUE</span>, <span class="dt">plot_log =</span> <span class="ot">TRUE</span>, <span class="dt">dates =</span> spy<span class="op">$</span>date)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">plot</span>(leverage, <span class="dt">include_ci =</span> <span class="ot">TRUE</span>, <span class="dt">plot_log =</span> <span class="ot">FALSE</span>, <span class="dt">dates =</span> spy<span class="op">$</span>date)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>We can simulate future returns with <code>predict</code>. This function returns three matrices of dimension <span class="math inline">\(\#\)</span> steps <span class="math inline">\(\times\)</span> #$ simulations: (1) the latent log-volatility <code>h</code>; (2) one for the percentage volatility <code>100 * sigma_y * exp(0.5 * h)</code> and (3) future returns. If the argument <code>include_parameters</code> is set to <code>TRUE</code>, the fixed parameters are simulated from their asymptotic multivariate distribution. This usually leads to broader uncertainty bands. To summarize the output from <code>predict</code>, we use the <code>summary</code> function, that calculate the mean and different quantiles based on the sumulations. We use the leverage model as an example:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a></span>
<span id="cb10-2"><a href="#cb10-2"></a>pred =<span class="st"> </span><span class="kw">predict</span>(leverage, <span class="dt">steps =</span> <span class="dv">10</span>, <span class="dt">include_parameters =</span> <span class="ot">TRUE</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="kw">summary</span>(pred)</span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co">#&gt; $y</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">#&gt;     time quantile_0.025 quantile_0.975          mean</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co">#&gt;  1:    1    -0.03697127     0.03680939 -9.955825e-05</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="co">#&gt;  2:    2    -0.03648798     0.03840502  1.568988e-04</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co">#&gt;  3:    3    -0.03730617     0.03762548  1.101025e-04</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co">#&gt;  4:    4    -0.03754075     0.03668388 -1.488216e-04</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="co">#&gt;  5:    5    -0.03738328     0.03561644 -2.068317e-04</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co">#&gt;  6:    6    -0.03673173     0.03751472 -3.566262e-04</span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co">#&gt;  7:    7    -0.03681117     0.03600734 -1.887601e-04</span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co">#&gt;  8:    8    -0.03565664     0.03503671  5.997296e-05</span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">#&gt;  9:    9    -0.03554914     0.03611945  3.988628e-04</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co">#&gt; 10:   10    -0.03517953     0.03379153 -4.540136e-05</span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">#&gt; </span></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="co">#&gt; $h</span></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co">#&gt;     time quantile_0.025 quantile_0.975     mean</span></span>
<span id="cb10-19"><a href="#cb10-19"></a><span class="co">#&gt;  1:    1    0.406543457       2.496289 1.452232</span></span>
<span id="cb10-20"><a href="#cb10-20"></a><span class="co">#&gt;  2:    2    0.240709893       2.555045 1.404871</span></span>
<span id="cb10-21"><a href="#cb10-21"></a><span class="co">#&gt;  3:    3    0.148866839       2.587771 1.359087</span></span>
<span id="cb10-22"><a href="#cb10-22"></a><span class="co">#&gt;  4:    4   -0.007521566       2.602513 1.312440</span></span>
<span id="cb10-23"><a href="#cb10-23"></a><span class="co">#&gt;  5:    5   -0.103075631       2.624392 1.273132</span></span>
<span id="cb10-24"><a href="#cb10-24"></a><span class="co">#&gt;  6:    6   -0.220723063       2.659166 1.235431</span></span>
<span id="cb10-25"><a href="#cb10-25"></a><span class="co">#&gt;  7:    7   -0.297637708       2.692436 1.199161</span></span>
<span id="cb10-26"><a href="#cb10-26"></a><span class="co">#&gt;  8:    8   -0.391764255       2.712487 1.160312</span></span>
<span id="cb10-27"><a href="#cb10-27"></a><span class="co">#&gt;  9:    9   -0.458938948       2.717130 1.124303</span></span>
<span id="cb10-28"><a href="#cb10-28"></a><span class="co">#&gt; 10:   10   -0.573202451       2.724519 1.079538</span></span>
<span id="cb10-29"><a href="#cb10-29"></a><span class="co">#&gt; </span></span>
<span id="cb10-30"><a href="#cb10-30"></a><span class="co">#&gt; $h_exp</span></span>
<span id="cb10-31"><a href="#cb10-31"></a><span class="co">#&gt;     time quantile_0.025 quantile_0.975       mean</span></span>
<span id="cb10-32"><a href="#cb10-32"></a><span class="co">#&gt;  1:    1    0.010133686     0.02928523 0.01790396</span></span>
<span id="cb10-33"><a href="#cb10-33"></a><span class="co">#&gt;  2:    2    0.009362090     0.03009821 0.01758150</span></span>
<span id="cb10-34"><a href="#cb10-34"></a><span class="co">#&gt;  3:    3    0.008854835     0.03063276 0.01732607</span></span>
<span id="cb10-35"><a href="#cb10-35"></a><span class="co">#&gt;  4:    4    0.008231126     0.03099414 0.01703866</span></span>
<span id="cb10-36"><a href="#cb10-36"></a><span class="co">#&gt;  5:    5    0.007801651     0.03150214 0.01673701</span></span>
<span id="cb10-37"><a href="#cb10-37"></a><span class="co">#&gt;  6:    6    0.007537907     0.03199674 0.01659772</span></span>
<span id="cb10-38"><a href="#cb10-38"></a><span class="co">#&gt;  7:    7    0.007156487     0.03236181 0.01638999</span></span>
<span id="cb10-39"><a href="#cb10-39"></a><span class="co">#&gt;  8:    8    0.006906869     0.03250785 0.01614453</span></span>
<span id="cb10-40"><a href="#cb10-40"></a><span class="co">#&gt;  9:    9    0.006583977     0.03235060 0.01584938</span></span>
<span id="cb10-41"><a href="#cb10-41"></a><span class="co">#&gt; 10:   10    0.006211188     0.03258687 0.01558458</span></span>
<span id="cb10-42"><a href="#cb10-42"></a></span>
<span id="cb10-43"><a href="#cb10-43"></a><span class="co"># plot the forecast</span></span>
<span id="cb10-44"><a href="#cb10-44"></a><span class="kw">plot</span>(leverage, <span class="dt">forecast =</span> <span class="dv">50</span>) <span class="op">+</span><span class="st"> </span>ggplot2<span class="op">::</span><span class="kw">xlim</span>(<span class="dv">3200</span>, <span class="kw">nrow</span>(spy) <span class="op">+</span><span class="st"> </span><span class="dv">50</span>)</span>
<span id="cb10-45"><a href="#cb10-45"></a><span class="co">#&gt; Warning: Removed 3199 row(s) containing missing values (geom_path).</span></span>
<span id="cb10-46"><a href="#cb10-46"></a></span>
<span id="cb10-47"><a href="#cb10-47"></a><span class="co">#&gt; Warning: Removed 3199 row(s) containing missing values (geom_path).</span></span>
<span id="cb10-48"><a href="#cb10-48"></a></span>
<span id="cb10-49"><a href="#cb10-49"></a><span class="co">#&gt; Warning: Removed 3199 row(s) containing missing values (geom_path).</span></span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="comparison-to-stochvol" class="section level1">
<h1>Comparison to stochvol</h1>
<p>The R-package <code>stochvol</code> (<span class="citation">Kastner (2016)</span>) provides a Bayesian framework for inference using Markov Chain Monte Carlo. An advantage of <code>stochvolTMB</code> is that optimization can be a lot faster than MCMC. We here compare the leverage and the gaussian model. Depending on your machine you can expect a speed up of 20-200x.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">library</span>(stochvol)</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>stochvol_gauss &lt;-<span class="st"> </span><span class="kw">svsample</span>(spy<span class="op">$</span>log_return, <span class="dt">quiet =</span> T)</span>
<span id="cb11-4"><a href="#cb11-4"></a>stochvolTMB_gauss  &lt;-<span class="st"> </span><span class="kw">estimate_parameters</span>(spy<span class="op">$</span>log_return, <span class="st">&quot;gaussian&quot;</span>, <span class="dt">silent =</span> <span class="ot">TRUE</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a></span>
<span id="cb11-6"><a href="#cb11-6"></a>stochvol_lev &lt;-<span class="st"> </span><span class="kw">svlsample</span>(spy<span class="op">$</span>log_return, <span class="dt">quiet =</span> T)</span>
<span id="cb11-7"><a href="#cb11-7"></a>stochvolTMB_lev  &lt;-<span class="st"> </span><span class="kw">estimate_parameters</span>(spy<span class="op">$</span>log_return, <span class="st">&quot;leverage&quot;</span>, <span class="dt">silent =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>We can compare the parameter estimates of the two methods. Note that the parameter <code>exp(mu/2)</code> and <code>sigma</code> from <code>stochvol</code> is the same as <code>sigma_y</code> and <code>sigma_h</code> from <code>stochvolTMB</code>. Both methods give almost identical results.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a></span>
<span id="cb12-2"><a href="#cb12-2"></a>stochvol_gauss<span class="op">$</span>para</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co">#&gt;                   mean           sd          5%          50%          95%</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">#&gt; mu        -9.611533785 0.1854455626 -9.91175182 -9.611774497 -9.304678419</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co">#&gt; phi        0.978189757 0.0049148914  0.96968612  0.978414831  0.985836137</span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="co">#&gt; sigma      0.229775055 0.0203786934  0.19733459  0.228942708  0.264098047</span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">#&gt; exp(mu/2)  0.008217761 0.0007671236  0.00704191  0.008181439  0.009539261</span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co">#&gt; sigma^2    0.053211825 0.0094502446  0.03894094  0.052414764  0.069747778</span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="co">#&gt;                 ESS</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="co">#&gt; mu        6230.1953</span></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="co">#&gt; phi        327.9347</span></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="co">#&gt; sigma      152.4001</span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="co">#&gt; exp(mu/2) 6230.1953</span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="co">#&gt; sigma^2    152.4001</span></span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="kw">summary</span>(stochvolTMB_gauss, <span class="dt">report =</span> <span class="st">&quot;transformed&quot;</span>)</span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="co">#&gt;    parameter    estimate    std_error   z_value      p_value        type</span></span>
<span id="cb12-17"><a href="#cb12-17"></a><span class="co">#&gt; 1:   sigma_y 0.008185162 0.0007314791  11.18988 4.570586e-29 transformed</span></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="co">#&gt; 2:   sigma_h 0.222440223 0.0190056672  11.70389 1.217431e-31 transformed</span></span>
<span id="cb12-19"><a href="#cb12-19"></a><span class="co">#&gt; 3:       phi 0.979034243 0.0046595769 210.11226 0.000000e+00 transformed</span></span>
<span id="cb12-20"><a href="#cb12-20"></a>stochvol_lev<span class="op">$</span>para</span>
<span id="cb12-21"><a href="#cb12-21"></a><span class="co">#&gt;                   mean           sd           5%          50%          95%</span></span>
<span id="cb12-22"><a href="#cb12-22"></a><span class="co">#&gt; mu        -9.569375399 0.1053851888 -9.739817718 -9.571446103 -9.400002030</span></span>
<span id="cb12-23"><a href="#cb12-23"></a><span class="co">#&gt; phi        0.966952934 0.0041187166  0.960195391  0.966853189  0.973557574</span></span>
<span id="cb12-24"><a href="#cb12-24"></a><span class="co">#&gt; sigma      0.276351629 0.0172514582  0.248100974  0.277044222  0.304057250</span></span>
<span id="cb12-25"><a href="#cb12-25"></a><span class="co">#&gt; rho       -0.724949416 0.0328632332 -0.775144574 -0.726905055 -0.667578807</span></span>
<span id="cb12-26"><a href="#cb12-26"></a><span class="co">#&gt; exp(mu/2)  0.008368349 0.0004417329  0.007674065  0.008348085  0.009095268</span></span>
<span id="cb12-27"><a href="#cb12-27"></a><span class="co">#&gt; sigma^2    0.076667806 0.0095068932  0.061554093  0.076753501  0.092450811</span></span>
<span id="cb12-28"><a href="#cb12-28"></a><span class="co">#&gt;                 ESS</span></span>
<span id="cb12-29"><a href="#cb12-29"></a><span class="co">#&gt; mu        368.69311</span></span>
<span id="cb12-30"><a href="#cb12-30"></a><span class="co">#&gt; phi       140.52279</span></span>
<span id="cb12-31"><a href="#cb12-31"></a><span class="co">#&gt; sigma      42.20112</span></span>
<span id="cb12-32"><a href="#cb12-32"></a><span class="co">#&gt; rho        26.56514</span></span>
<span id="cb12-33"><a href="#cb12-33"></a><span class="co">#&gt; exp(mu/2) 368.69311</span></span>
<span id="cb12-34"><a href="#cb12-34"></a><span class="co">#&gt; sigma^2    42.20112</span></span>
<span id="cb12-35"><a href="#cb12-35"></a><span class="kw">summary</span>(stochvolTMB_lev, <span class="dt">report =</span> <span class="st">&quot;transformed&quot;</span>)</span>
<span id="cb12-36"><a href="#cb12-36"></a><span class="co">#&gt;    parameter     estimate    std_error   z_value       p_value        type</span></span>
<span id="cb12-37"><a href="#cb12-37"></a><span class="co">#&gt; 1:   sigma_y  0.008338412 0.0004163314  20.02830  3.121144e-89 transformed</span></span>
<span id="cb12-38"><a href="#cb12-38"></a><span class="co">#&gt; 2:   sigma_h  0.273443559 0.0182641070  14.97164  1.125191e-50 transformed</span></span>
<span id="cb12-39"><a href="#cb12-39"></a><span class="co">#&gt; 3:       phi  0.967721215 0.0043681868 221.53842  0.000000e+00 transformed</span></span>
<span id="cb12-40"><a href="#cb12-40"></a><span class="co">#&gt; 4:       rho -0.748695259 0.0322487815 -23.21623 3.121690e-119 transformed</span></span></code></pre></div>
</div>
<div id="estimation" class="section level1">
<h1>Estimation</h1>
<p>The R-package <code>TMB</code> (<span class="citation">Kristensen et al. (2016)</span>) is used to implement our models for maximum likelihood estimation, since <code>TMB</code> lets us estimate parameters in models with a high number of latent variables.</p>
<p>Parameter estimation of stochastic volatility models is hard due to the fact the likelihood function is expressed as a high dimensional integral over the latent variables that cannot be evaluated analytically. If <span class="math inline">\(\boldsymbol{y} = (y_1, \ldots, y_T)\)</span> denotes our observations, <span class="math inline">\(\boldsymbol{h} = (h_1, \ldots, h_T)\)</span> our latent variables and <span class="math inline">\(\boldsymbol{\theta}\)</span> the parameters of interest, the likelihood of <span class="math inline">\(\boldsymbol{\theta}\)</span> is given by</p>
<p><span class="math display">\[\begin{equation}
    \mathcal{L}(\boldsymbol{\theta}) = \int f_{\boldsymbol{y}}(\boldsymbol{y}|\boldsymbol{h})f_{\boldsymbol{h}}(\boldsymbol{h}) \, d\boldsymbol{h},
\end{equation}\]</span></p>
<p>The conditional density of our observations given <span class="math inline">\(\boldsymbol{h}\)</span> is denoted by <span class="math inline">\(f_{\boldsymbol{y}}(\boldsymbol{y|u})\)</span>, and <span class="math inline">\(f_{\boldsymbol{h}}(\boldsymbol{h})\)</span> denotes the marginal density of <span class="math inline">\(\boldsymbol{h}\)</span>. To approximate this integral we apply the Laplace approximation.</p>
<div id="laplace-approximation" class="section level2">
<h2>Laplace Approximation</h2>
<p>Let <span class="math inline">\(\boldsymbol{y}\)</span> be a vector of observations, <span class="math inline">\(\boldsymbol{\theta}\)</span> our parameters of interest and <span class="math inline">\(\boldsymbol{h}\)</span> be a random vector of latent variables. Let <span class="math inline">\(g(\boldsymbol{h},\boldsymbol{\theta})\)</span> denote the negative joint log-likelihood. The likelihood of <span class="math inline">\(\boldsymbol{\theta}\)</span> is given by</p>
<p><span class="math display">\[\begin{equation}
    \mathcal{L}(\boldsymbol{\theta}) = \int f(\boldsymbol{y},\boldsymbol{h}) \, d\boldsymbol{h} = \int f_{\boldsymbol{y}}(\boldsymbol{y|u}) f_{\boldsymbol{h}}(\boldsymbol{h}) \, d\boldsymbol{h} = \int \exp \{-g(\boldsymbol{h},\boldsymbol{\theta})\} \, d\boldsymbol{h}.
\end{equation}\]</span></p>
<p>We assume that <span class="math inline">\(g\)</span> has a global minimum at <span class="math inline">\(\boldsymbol{\hat{h}}\)</span> for a given <span class="math inline">\(\boldsymbol{\theta}\)</span>, i.e. <span class="math inline">\(\boldsymbol{\hat{h}} = \text{argmin}_{\boldsymbol{h}} g(\boldsymbol{h},\boldsymbol{\theta})\)</span>, and that <span class="math inline">\(g\)</span> is twice differentiable. The solution <span class="math inline">\(\hat{\boldsymbol{h}}\)</span> is known as the <em>Empirical Bayes</em> (EB) estimate. A second order Taylor expansion around <span class="math inline">\(\boldsymbol{\hat{h}}\)</span> yields</p>
<p><span class="math display">\[\begin{equation}
    g(\boldsymbol{h},\boldsymbol{\theta}) \approx g(\boldsymbol{\hat{h}},\boldsymbol{\theta}) + \nabla g(\boldsymbol{\hat{h}},\boldsymbol{\theta})(\boldsymbol{h} - \boldsymbol{\hat{h}}) + \frac{1}{2}(\boldsymbol{h} - \boldsymbol{\hat{h}})^T\mathbb{H}(\boldsymbol{h} - \boldsymbol{\hat{h}})
\end{equation}\]</span></p>
<p>Since <span class="math inline">\(\boldsymbol{\hat{h}}\)</span> is a minimum, <span class="math inline">\(\nabla g(\boldsymbol{\hat{h}},\boldsymbol{\theta}) = 0\)</span>. Therefore</p>
<p><span class="math display">\[\begin{equation}
    \mathcal{L}(\boldsymbol{\theta}) \approx \exp \{-g(\boldsymbol{\hat{h}},\boldsymbol{\theta})\} \int \exp \bigg \{-\frac{1}{2}(\boldsymbol{h} - \boldsymbol{\hat{h}})^T\mathbb{H}(\boldsymbol{h} - \boldsymbol{\hat{h}}) \bigg \} d\boldsymbol{h}
\end{equation}\]</span></p>
<p>We can observe that the integrand is the kernel of a multivariate normal density with covariance matrix <span class="math inline">\(\mathbb{H}^{-1}\)</span>. The approximation is therefore given by</p>
<p><span class="math display">\[\begin{equation}
    \mathcal{L}(\boldsymbol{\theta}) \approx \exp \{-g(\boldsymbol{\hat{h}},\boldsymbol{\theta})\} (2\pi)^{\text{dim}(\boldsymbol{h})/2} \text{det}(\mathbb{H})^{-1/2},
\end{equation}\]</span></p>
<p>where we have used the fact that <span class="math inline">\(\text{det}(\mathbb{H}^{-1}) = \text{det}(\mathbb{H})^{-1}\)</span>. The corresponding negative log-likelihood is</p>
<p><span class="math display">\[\begin{equation}
    -l(\boldsymbol{\theta}) = -\frac{\text{dim}(\boldsymbol{h})}{2} \log (2\pi) + \frac{1}{2} \log \text{det}(\mathbb{H}) + g(\boldsymbol{\hat{h}},\boldsymbol{\theta}).
\end{equation}\]</span></p>
<p>Finding the optimal value of <span class="math inline">\(\boldsymbol{\theta}\)</span> can be viewed as a nested optimization problem. To find <span class="math inline">\(\boldsymbol{h} (\boldsymbol{\theta})\)</span> and <span class="math inline">\(\mathbb{H}(\boldsymbol{\theta})\)</span> we fix <span class="math inline">\(\boldsymbol{\theta}\)</span> and optimize using a quasi-Newton algorithm or a limited memory Newton method. The Laplace approximation is then optimized w.r.t. <span class="math inline">\(\boldsymbol{\theta}\)</span> using the quasi-Newton algorithm.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-kastner2016">
<p>Kastner, Gregor. 2016. “Dealing with Stochastic Volatility in Time Series Using the R Package stochvol.” <em>Journal of Statistical Software</em> 69 (5): 1–30. <a href="https://doi.org/10.18637/jss.v069.i05">https://doi.org/10.18637/jss.v069.i05</a>.</p>
</div>
<div id="ref-TMB_2016">
<p>Kristensen, Kasper, Anders Nielsen, Casper Berg, Hans Skaug, and Bradley Bell. 2016. “TMB: Automatic Differentiation and Laplace Approximation.” <em>Journal of Statistical Software, Articles</em> 70 (5): 1–21. <a href="https://doi.org/10.18637/jss.v070.i05">https://doi.org/10.18637/jss.v070.i05</a>.</p>
</div>
<div id="ref-Taylor_SV_1982">
<p>Taylor, S. J. 1982. “Financial Returns Modelled by the Product of Two Stochastic Processes-a Study of the Daily Sugar Prices 1961-75.” <em>Time Series Analysis : Theory and Practice</em> 1: 203–26. <a href="https://ci.nii.ac.jp/naid/10018822959/en/">https://ci.nii.ac.jp/naid/10018822959/en/</a>.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
